(this.webpackJsonpkeyboard=this.webpackJsonpkeyboard||[]).push([[0],{31:function(e,t,a){},53:function(e,t,a){},54:function(e,t,a){},57:function(e,t,a){"use strict";a.r(t);var n=a(6),r=a.n(n),c=a(22),i=a.n(c),s=(a(31),a(2)),o=a(11),l=a(26),d=a(3);var u=function(e){return Object(d.jsx)("button",{className:"btn btn-action s-circle",onClick:e.onClick,disabled:e.disabled,children:Object(d.jsx)(l.a,{icon:e.iconProp})})},b=function(e){var t=function(e){return e.toString().padStart(2,"0")},a=Math.floor(e%86400/3600),n=Math.floor(e%86400%3600/60),r=Math.floor(e%86400%3600%60);return a?a+":"+n+":"+t(r):n+":"+t(r)};var j=function(e){return Object(d.jsxs)("span",{className:"base-time",children:[b(e.time)," / ",b(e.duration)]})},v=a(7),m=function(e){Object(n.useEffect)((function(){var t=(new v.c).toDestination();t.set({oscillator:{type:"sawtooth32"},envelope:{attack:0,decay:1,sustain:0,release:.4}}),e({type:"LOADED_SYNTH",payload:{isLoaded:!0,synth:t}})}),[e])},p=a(0),O=Object(n.createContext)({}),f={time:0,duration:0,toneState:"stopped",isLoaded:!1,synth:void 0,disabled:!0,playbackTimeID:0},h=function(e,t){switch(t.type){case"LOADED_SYNTH":var a=t.payload;return Object(p.a)(Object(p.a)({},e),{},{isLoaded:a.isLoaded,synth:a.synth});case"LOADED_MIDI":var n=t.payload;return Object(p.a)(Object(p.a)({},e),{},{duration:n.duration,time:0,disabled:!1,toneState:v.d.start().state,playbackTimeID:n.playbackTimeID});case"COUNT_TIME":return e.duration>e.time?Object(p.a)(Object(p.a)({},e),{},{time:e.time+1}):(window.clearInterval(e.playbackTimeID),Object(p.a)(Object(p.a)({},e),{},{time:0,toneState:v.d.stop().state,playbackTimeID:0}));case"PLAY_MIDI":return Object(p.a)(Object(p.a)({},e),{},{toneState:v.d.start().state,playbackTimeID:t.payload.playbackTimeID});case"PAUSE_MIDI":return window.clearInterval(e.playbackTimeID),Object(p.a)(Object(p.a)({},e),{},{toneState:v.d.pause().state,playbackTimeID:0});case"STOP_MIDI":return window.clearInterval(e.playbackTimeID),Object(p.a)(Object(p.a)({},e),{},{time:0,toneState:v.d.stop().state,playbackTimeID:0})}},y=function(){return Object(n.useContext)(O).state.synth},k=a(23),x=function(){var e=Object(n.useContext)(O),t=e.state,a=e.dispatch,r=Object(n.useState)(!1),c=Object(s.a)(r,2),i=c[0],o=c[1],l=t.synth,d=function(){return window.setInterval((function(){return a({type:"COUNT_TIME"})}),1e3)};return{state:Object(p.a)({isMute:i},t),handlers:{dropFile:function(e){var t=Object(s.a)(e.target.files,1)[0],n=new FileReader;n.onload=function(e){var t=new k.Midi(e.target.result);v.d.cancel(),t.tracks.forEach((function(e){new v.b((function(e,t){null===l||void 0===l||l.triggerAttackRelease(t.name,t.duration,e,t.velocity);var a=document.querySelector('[data-key-num="'.concat(function(e){return Object(v.a)(e).toMidi()}(t.name),'"]')).classList;a.add("--pressing"),setTimeout((function(){return a.remove("--pressing")}),1e3*t.duration)}),e.notes).start()})),a({type:"LOADED_MIDI",payload:{duration:Math.ceil(t.duration),playbackTimeID:d()}})},n.readAsArrayBuffer(t)},PlayPause:function(){return a("started"!==t.toneState?{type:"PLAY_MIDI",payload:{playbackTimeID:d()}}:{type:"PAUSE_MIDI"})},stop:function(){return a({type:"STOP_MIDI"})},toggleVolume:function(){if(l){var e=l.volume;e.value=i?0:e.minValue,o(!i)}}}}};var I=function(e){var t=e.usePlayer,a=(void 0===t?x:t)(),n=a.state,r=a.handlers;return Object(d.jsxs)("div",{className:"the-menu",children:[Object(d.jsx)("div",{className:"the-menu__filedrop form-group",children:Object(d.jsx)("input",{className:"form-input",type:"file",accept:"audio/midi",onChange:r.dropFile})}),Object(d.jsxs)("div",{className:"the-menu__toolbar el-cluster el-cluster--justify:flex-start",children:[Object(d.jsx)(u,{onClick:r.PlayPause,iconProp:"started"!==n.toneState?o.b:o.a,disabled:n.disabled}),Object(d.jsx)(u,{onClick:r.stop,iconProp:o.c,disabled:n.disabled}),Object(d.jsx)(u,{onClick:r.toggleVolume,iconProp:n.isMute?o.d:o.e}),Object(d.jsx)(j,{time:n.time,duration:n.duration})]})]})},g=a(4),D=a(24),_=a(25),N=(a(53),function(e){var t=Object(D.a)(e),a=t.slice(0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return a.reduce((function(e,t,r){return r%n?e:[].concat(Object(g.a)(e),[a.slice(r,r+n)])}),[])}),T=Object(_.a)(21,109),w=T.length/2,S=function(e){return Object(v.a)(e,"midi").toNote()},L=function(e){switch((e-20)%12){case 0:case 2:case 5:case 7:case 10:return!0;default:return!1}};var P=function(e){var t=e.useSynth,a=(void 0===t?y:t)(),n=function(e){var t=e.target;t.classList.add("--pressing"),null===a||void 0===a||a.triggerAttack(S(t.dataset.keyNum))},r=function(e){var t=e.target;t.classList.remove("--pressing"),null===a||void 0===a||a.triggerRelease(S(t.dataset.keyNum))};return Object(d.jsx)("div",{className:"the-keyboard el-stack",onPointerDown:function(e){n(e);var t=e.currentTarget;t.addEventListener("pointerover",n),t.addEventListener("pointerout",r)},onPointerUp:function(e){r(e);var t=e.currentTarget;t.removeEventListener("pointerover",n),t.removeEventListener("pointerout",r)},children:N(T,w).map((function(e,t){return Object(d.jsx)("div",{className:"the-keyboard__row",children:e.map((function(e){var t=S(e);return Object(d.jsx)("div",{className:"the-keyboard__key-container",children:Object(d.jsx)("div",{className:"the-keyboard__key "+(L(e)?"--black":"--white"),"data-key-num":e,children:Object(d.jsx)("span",{className:"the-keyboard__label",children:/C[1-8]/.test(t)?t:""})})},e-21)}))},t)}))})};var M=function(e){return Object(d.jsx)("a",{className:"base-link",href:e.url,target:"_blank",rel:"noopener noreferrer",children:e.label})};var C=function(){return Object(d.jsx)("div",{className:"the-footer-child el-center",children:Object(d.jsxs)("small",{className:"the-footer-child__container",children:[Object(d.jsx)(M,{url:"https://github.com/l1ck0h/keyboard",label:"GitHub"})," / \xa9 2022 l1ck0h"]})})};var E=function(){return Object(d.jsx)("div",{className:"el-cover",children:Object(d.jsx)("div",{className:"el-cover__centered text-center",children:Object(d.jsx)("div",{className:"loading loading-lg"})})})};a(54);var A=function(){var e=Object(n.useReducer)(h,f),t=Object(s.a)(e,2),a=t[0],r=t[1];return m(r),Object(d.jsx)("div",{className:"App",children:a.isLoaded?Object(d.jsx)(O.Provider,{value:{state:a,dispatch:r},children:Object(d.jsxs)("div",{className:"el-cover",children:[Object(d.jsx)(I,{}),Object(d.jsx)("div",{className:"el-cover__centered",style:{overflowX:"auto"},children:Object(d.jsx)(P,{})}),Object(d.jsx)(C,{})]})}):Object(d.jsx)(E,{})})},F=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,58)).then((function(t){var a=t.getCLS,n=t.getFID,r=t.getFCP,c=t.getLCP,i=t.getTTFB;a(e),n(e),r(e),c(e),i(e)}))};a(55),a(56);i.a.render(Object(d.jsx)(r.a.StrictMode,{children:Object(d.jsx)(A,{})}),document.getElementById("root")),F()}},[[57,1,2]]]);
//# sourceMappingURL=main.f039d75d.chunk.js.map