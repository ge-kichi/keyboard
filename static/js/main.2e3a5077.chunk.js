(this.webpackJsonpkeyboard=this.webpackJsonpkeyboard||[]).push([[0],{26:function(e,t,a){},48:function(e,t,a){},51:function(e,t,a){"use strict";a.r(t);var r=a(5),n=a.n(r),c=a(18),i=a.n(c),s=(a(26),a(3)),o=a(10),l=a(21),d=a(2);var u=function(e){return Object(d.jsx)("button",{className:"btn btn-action s-circle",onClick:e.onClick,disabled:e.disabled,children:Object(d.jsx)(l.a,{icon:e.iconProp})})},m=function(e){var t=function(e){return e.toString().padStart(2,"0")},a=Math.floor(e%86400/3600),r=Math.floor(e%86400%3600/60),n=Math.floor(e%86400%3600%60);return a?a+":"+r+":"+t(n):r+":"+t(n)};var b=function(e){return Object(d.jsxs)("span",{className:"base-time",children:[m(e.time)," / ",m(e.duration)]})},p=a(6),v=function(e){return Object(p.a)(e,"midi").toNote()},j=a(0),O=Object(r.createContext)({}),f={time:0,duration:0,toneState:"stopped",isLoaded:!1,sampler:void 0,disabled:!0,playbackTimeID:0},y=function(e,t){switch(t.type){case"LOADED_SAMPLER":var a=t.payload;return Object(j.a)(Object(j.a)({},e),{},{isLoaded:a.isLoaded,sampler:a.sampler});case"LOADED_MIDI":var r=t.payload;return Object(j.a)(Object(j.a)({},e),{},{duration:r.duration,time:0,disabled:!1,toneState:p.d.start().state,playbackTimeID:r.playbackTimeID});case"COUNT_TIME":return e.duration>e.time?Object(j.a)(Object(j.a)({},e),{},{time:e.time+1}):(window.clearInterval(e.playbackTimeID),Object(j.a)(Object(j.a)({},e),{},{time:0,toneState:p.d.stop().state,playbackTimeID:0}));case"PLAY_MIDI":return Object(j.a)(Object(j.a)({},e),{},{toneState:p.d.start().state,playbackTimeID:t.payload.playbackTimeID});case"PAUSE_MIDI":return window.clearInterval(e.playbackTimeID),Object(j.a)(Object(j.a)({},e),{},{toneState:p.d.pause().state,playbackTimeID:0});case"STOP_MIDI":return window.clearInterval(e.playbackTimeID),Object(j.a)(Object(j.a)({},e),{},{time:0,toneState:p.d.stop().state,playbackTimeID:0})}},h=function(){var e=Object(r.useContext)(O).state,t=function(t){if(e.sampler){var a=t.target;a.dataset.keyNum&&(a.classList.add("Keyboard__key--pressing"),e.sampler.triggerAttack(v(a.dataset.keyNum)))}},a=function(t){if(e.sampler){var a=t.target;a.classList.remove("Keyboard__key--pressing"),e.sampler.triggerRelease(v(a.dataset.keyNum))}},n=function(e){0!==Array.from(document.querySelectorAll(":active")).length&&t(e)},c=function(e){return a(e)},i=function(e){return e.preventDefault()};return{pressKey:function(e){t(e);var a=e.currentTarget;a.addEventListener("pointerover",n),a.addEventListener("pointerout",c),a.addEventListener("touchmove",i)},releaseKey:function(e){a(e);var t=e.currentTarget;t.removeEventListener("pointerover",n),t.removeEventListener("pointerout",c),t.removeEventListener("touchmove",i)}}},k=a(19),D=function(){var e=Object(r.useContext)(O),t=e.state,a=e.dispatch,n=Object(r.useState)(!1),c=Object(s.a)(n,2),i=c[0],o=c[1],l=t.sampler,d=function(){return window.setInterval((function(){return a({type:"COUNT_TIME"})}),1e3)};return{state:Object(j.a)({isMute:i},t),handlers:{dropFile:function(e){var t=Object(s.a)(e.target.files,1)[0],r=new FileReader;r.onload=function(e){var t=new k.Midi(e.target.result);p.d.cancel(),t.tracks.forEach((function(e){new p.b((function(e,t){l.triggerAttackRelease(t.name,t.duration,e,t.velocity);var a=document.querySelector('[data-key-num="'.concat(function(e){return Object(p.a)(e).toMidi()}(t.name),'"]'));a.classList.add("Keyboard__key--pressing"),setTimeout((function(){return a.classList.remove("Keyboard__key--pressing")}),900*t.duration)}),e.notes).start()})),a({type:"LOADED_MIDI",payload:{duration:Math.ceil(t.duration),playbackTimeID:d()}})},r.readAsArrayBuffer(t)},PlayPause:function(){"started"!==t.toneState?a({type:"PLAY_MIDI",payload:{playbackTimeID:d()}}):a({type:"PAUSE_MIDI"})},stop:function(){return a({type:"STOP_MIDI"})},toggleVolume:function(){l&&(l.volume.value=i?0:l.volume.minValue,o(!i))}}}},x=function(e){Object(r.useEffect)((function(){var t=new p.c({attack:0,urls:{A0:"A0v1.mp3",C1:"C1v1.mp3","D#1":"Ds1v1.mp3","F#1":"Fs1v1.mp3",A1:"A1v1.mp3",C2:"C2v1.mp3","D#2":"Ds2v1.mp3","F#2":"Fs2v1.mp3",A2:"A2v1.mp3",C3:"C3v1.mp3","D#3":"Ds3v1.mp3","F#3":"Fs3v1.mp3",A3:"A3v1.mp3",C4:"C4v1.mp3","D#4":"Ds4v1.mp3","F#4":"Fs4v1.mp3",A4:"A4v1.mp3",C5:"C5v1.mp3","D#5":"Ds5v1.mp3","F#5":"Fs5v1.mp3",A5:"A5v1.mp3",C6:"C6v1.mp3","D#6":"Ds6v1.mp3","F#6":"Fs6v1.mp3",A6:"A6v1.mp3",C7:"C7v1.mp3","D#7":"Ds7v1.mp3","F#7":"Fs7v1.mp3",A7:"A7v1.mp3",C8:"C8v1.mp3"},baseUrl:"/keyboard/audio/",release:1,onload:function(){return e({type:"LOADED_SAMPLER",payload:{isLoaded:!0,sampler:t}})}}).toDestination()}),[e])};var _=function(){var e=D(),t=e.state,a=e.handlers;return Object(d.jsxs)("div",{className:"the-menu",children:[Object(d.jsx)("div",{className:"the-menu__filedrop form-group",children:Object(d.jsx)("input",{className:"form-input",type:"file",accept:"audio/midi",onChange:a.dropFile})}),Object(d.jsxs)("div",{className:"the-menu__toolbar el-cluster el-cluster--justify:flex-start",children:[Object(d.jsx)(u,{onClick:a.PlayPause,iconProp:"started"!==t.toneState?o.b:o.a,disabled:t.disabled}),Object(d.jsx)(u,{onClick:a.stop,iconProp:o.c,disabled:t.disabled}),Object(d.jsx)(u,{onClick:a.toggleVolume,iconProp:t.isMute?o.d:o.e}),Object(d.jsx)(b,{time:t.time,duration:t.duration})]})]})},I=a(20);var g=function(e){var t,a=(t=e.midiNote,Object(p.a)(t,"midi").toNote());return Object(d.jsx)("div",{className:"Keyboard__key-container",children:Object(d.jsx)("div",{className:e.isBlackKey?"Keyboard__key--black":"Keyboard__key--white","data-key-num":e.midiNote,children:Object(d.jsx)("span",{className:"Keyboard__label",children:/C[1-8]/.test(a)?a:""})})})},A=Object(I.a)(21,109),C=function(e){switch((e-20)%12){case 0:case 2:case 5:case 7:case 10:return!0;default:return!1}};var N=function(){var e=h(),t=e.pressKey,a=e.releaseKey;return Object(d.jsx)("div",{className:"the-keyboard",onPointerDown:t,onPointerUp:a,children:Object(d.jsx)("div",{className:"Keyboard app-util-width:100%",children:A.map((function(e,t){return Object(d.jsx)(g,{midiNote:e,isBlackKey:C(e)},t)}))})})};var L=function(e){return Object(d.jsx)("a",{className:"base-link",href:e.url,target:"_blank",rel:"noopener noreferrer",children:e.label})};var T=function(){return Object(d.jsx)("div",{className:"the-footer-child el-center",children:Object(d.jsxs)("small",{className:"the-footer-child__container",children:[Object(d.jsx)(L,{url:"https://github.com/l1ck0h/keyboard",label:"GitHub"})," / \xa9 2022 l1ck0h"]})})};var F=function(){return Object(d.jsx)("div",{className:"el-cover",children:Object(d.jsx)("div",{className:"el-cover__centered text-center",children:Object(d.jsx)("div",{className:"loading loading-lg"})})})};a(48);var M=function(){var e=Object(r.useReducer)(y,f),t=Object(s.a)(e,2),a=t[0],n=t[1];return x(n),Object(d.jsx)("div",{className:"App",children:a.isLoaded?Object(d.jsx)(O.Provider,{value:{state:a,dispatch:n},children:Object(d.jsxs)("div",{className:"el-cover",children:[Object(d.jsx)(_,{}),Object(d.jsx)("div",{className:"el-cover__centered app-util-margin:auto",children:Object(d.jsx)(N,{})}),Object(d.jsx)(T,{})]})}):Object(d.jsx)(F,{})})},P=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,52)).then((function(t){var a=t.getCLS,r=t.getFID,n=t.getFCP,c=t.getLCP,i=t.getTTFB;a(e),r(e),n(e),c(e),i(e)}))};a(49),a(50);i.a.render(Object(d.jsx)(n.a.StrictMode,{children:Object(d.jsx)(M,{})}),document.getElementById("root")),P()}},[[51,1,2]]]);
//# sourceMappingURL=main.2e3a5077.chunk.js.map