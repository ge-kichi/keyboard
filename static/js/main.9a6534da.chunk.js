(this.webpackJsonpkeyboard=this.webpackJsonpkeyboard||[]).push([[0],{31:function(e,t,a){},53:function(e,t,a){},54:function(e,t,a){},59:function(e,t,a){"use strict";a.r(t);var n=a(6),r=a.n(n),c=a(23),i=a.n(c),l=(a(31),a(3)),s=a(2);var o=function(e){var t=n.Children.toArray(e.children),a=Object(l.a)(t,2),r=a[0],c=a[1];return Object(s.jsxs)("div",{className:"el-cluster el-cluster--justify:space-between el-cluster--space:0",children:[Object(s.jsx)("div",{style:{width:"91px"},children:r}),Object(s.jsx)("div",{children:c})]})};var u=function(e){return Object(s.jsxs)(o,{children:[Object(s.jsx)("label",{className:"form-label",htmlFor:e.label,children:e.label}),Object(s.jsx)("input",{type:"number",id:e.label,className:"form-input",min:e.min,max:e.max,step:e.step,value:e.value,onChange:e.onChange})]})};var d=function(e){return Object(s.jsxs)(o,{children:[Object(s.jsx)("label",{className:"form-label",children:e.label}),Object(s.jsx)(s.Fragment,{children:n.Children.map(e.children,(function(t,a){return Object(s.jsxs)("label",{className:"form-radio form-inline",children:[Object(s.jsx)("input",{type:"radio",name:e.name,value:t,checked:t===e.value,onChange:e.onChange}),Object(s.jsx)("i",{className:"form-icon"}),t]},a)}))})]})};var b=function(e){return Object(s.jsxs)("ul",{className:"menu",children:[Object(s.jsx)("div",{className:"tile tile-centered",style:{marginBottom:"var(--ms-1)"},children:Object(s.jsx)("div",{className:"tile-content",children:Object(s.jsx)("div",{className:"tile-title",children:e.contentName})})}),n.Children.map(e.children,(function(e,t){return Object(s.jsx)("li",{className:"menu-item",children:e},t)}))]})};var j=function(e){return Object(s.jsxs)(o,{children:[Object(s.jsx)("label",{className:"form-label",htmlFor:e.id,children:e.label}),Object(s.jsx)("select",{id:e.id,className:"form-select",value:e.value,onChange:e.onChange,children:n.Children.map(e.children,(function(e,t){return Object(s.jsx)("option",{value:e,children:e},t)}))})]})},m=a(16),v=a(26);var h=function(e){return Object(s.jsx)("button",{className:"btn btn-action s-circle",onClick:e.onClick,disabled:e.disabled,children:Object(s.jsx)(v.a,{icon:e.iconProp})})},p=function(e){var t=function(e){return e.toString().padStart(2,"0")},a=Math.floor(e%86400/3600),n=Math.floor(e%86400%3600/60),r=Math.floor(e%86400%3600%60);return a?a+":"+n+":"+t(r):n+":"+t(r)};var O=function(e){return Object(s.jsxs)("span",{className:"base-time",children:[p(e.time)," / ",p(e.duration)]})},f=a(1),y=a(7),x=(new y.c).toDestination(),g=x.get(),C=Object(n.createContext)({}),k={time:0,duration:0,toneState:"stopped",synth:x,synthParams:g,playerDisabled:!0,playbackTimeID:0},N=function(e,t){switch(t.type){case"SET_SYNTH_PARAMS":return Object(f.a)(Object(f.a)({},e),{},{synthParams:t.payload.synthParams});case"LOADED_MIDI":var a=t.payload;return Object(f.a)(Object(f.a)({},e),{},{duration:a.duration,time:0,playerDisabled:!1,toneState:y.d.start().state,playbackTimeID:a.playbackTimeID});case"COUNT_TIME":return e.duration>e.time?Object(f.a)(Object(f.a)({},e),{},{time:e.time+1}):(window.clearInterval(e.playbackTimeID),Object(f.a)(Object(f.a)({},e),{},{time:0,toneState:y.d.stop().state,playbackTimeID:0}));case"PLAY_MIDI":return Object(f.a)(Object(f.a)({},e),{},{toneState:y.d.start().state,playbackTimeID:t.payload.playbackTimeID});case"PAUSE_MIDI":return window.clearInterval(e.playbackTimeID),Object(f.a)(Object(f.a)({},e),{},{toneState:y.d.pause().state,playbackTimeID:0});case"STOP_MIDI":return window.clearInterval(e.playbackTimeID),Object(f.a)(Object(f.a)({},e),{},{time:0,toneState:y.d.stop().state,playbackTimeID:0})}},I=function(){return Object(n.useContext)(C).state.synth},P=a(10),D=function(e,t){switch(e){case"detune":case"portamento":case"volume":return t(Object(P.b)([e]));case"type":case"partialCount":case"phase":return t(Object(P.b)(["oscillator",e]));case"attack":case"attackCurve":case"decay":case"decayCurve":case"release":case"releaseCurve":case"sustain":return t(Object(P.b)(["envelope",e]))}},_=Object(P.a)((function(e,t){return Object(P.e)(t,e)})),w=Object(P.a)((function(e,t,a){return Object(P.d)(t,a,e)})),T=function(){var e=Object(n.useContext)(C),t=e.state,a=e.dispatch,r=_(t.synthParams),c=w(t.synthParams);return{getParams:function(e){return D(e,(function(e){return r(e)}))},setParams:function(e,n){var r=D(e,(function(e){var a=c(e);return t.synth.set(a(n||"0")),a(n)}));a({type:"SET_SYNTH_PARAMS",payload:{synthParams:r}})}}},S=a(24),M=function(){var e=Object(n.useContext)(C),t=e.state,a=e.dispatch,r=t.synth,c=function(){return window.setInterval((function(){return a({type:"COUNT_TIME"})}),1e3)};return{state:t,handlers:{dropFile:function(e){var t=Object(l.a)(e.target.files,1)[0],n=new FileReader;n.onload=function(e){var t=new S.Midi(e.target.result);y.d.cancel(),t.tracks.forEach((function(e){new y.b((function(e,t){null===r||void 0===r||r.triggerAttackRelease(t.name,t.duration,e,t.velocity);var a=document.querySelector('[data-key-num="'.concat(function(e){return Object(y.a)(e).toMidi()}(t.name),'"]')).dataset;a.active="true",setTimeout((function(){return a.active="false"}),1e3*t.duration)}),e.notes).start()})),a({type:"LOADED_MIDI",payload:{duration:Math.ceil(t.duration),playbackTimeID:c()}})},n.readAsArrayBuffer(t)},PlayPause:function(){return a("started"!==t.toneState?{type:"PLAY_MIDI",payload:{playbackTimeID:c()}}:{type:"PAUSE_MIDI"})},stop:function(){return a({type:"STOP_MIDI"})}}}};var A=function(e){var t=e.usePlayer,a=(void 0===t?M:t)(),n=a.state,r=a.handlers;return Object(s.jsxs)("div",{className:"the-menu",children:[Object(s.jsx)("div",{className:"the-menu__filedrop form-group",children:Object(s.jsx)("input",{type:"file",id:"dropFile",className:"form-input",accept:"audio/midi",onChange:r.dropFile})}),Object(s.jsxs)("div",{className:"the-menu__toolbar el-cluster el-cluster--justify:flex-start",children:[Object(s.jsx)(h,{onClick:r.PlayPause,iconProp:"started"!==n.toneState?m.b:m.a,disabled:n.playerDisabled}),Object(s.jsx)(h,{onClick:r.stop,iconProp:m.c,disabled:n.playerDisabled}),Object(s.jsx)(O,{time:n.time,duration:n.duration})]})]})};var E=function(){var e=T(),t=e.getParams,a=e.setParams;return Object(s.jsxs)("div",{className:"el-grid",children:[Object(s.jsxs)("div",{style:{display:"flex",flexFlow:"column",justifyContent:"space-between"},children:[Object(s.jsxs)(b,{contentName:"options",children:[Object(s.jsx)(u,{label:"detune",id:"detune",value:t("detune"),onChange:function(e){return a("detune",e.target.value)}}),Object(s.jsx)(u,{label:"portamento",id:"portamento",min:"0",value:t("portamento"),onChange:function(e){return a("portamento",e.target.value)}}),Object(s.jsx)(u,{label:"volume",id:"volume",value:t("volume"),onChange:function(e){return a("volume",e.target.value)}})]}),Object(s.jsx)(b,{contentName:"player",children:Object(s.jsx)(A,{})})]}),Object(s.jsxs)(b,{contentName:"ocillator",children:[Object(s.jsx)(j,{label:"type",id:"type",value:t("type"),onChange:function(e){return a("type",e.target.value)},children:["sine","square","sawtooth","triangle"]}),Object(s.jsx)(u,{label:"partialCount",id:"partialCount",min:"0",step:"1",value:t("partialCount"),onChange:function(e){return a("partialCount",e.target.value)}}),Object(s.jsx)(u,{label:"phase",id:"phase",min:"0",step:"0.1",value:t("phase"),onChange:function(e){return a("phase",e.target.value)}})]}),Object(s.jsxs)(b,{contentName:"envelope",children:[Object(s.jsx)(u,{label:"attack",id:"attack",min:"0",step:"0.001",value:t("attack"),onChange:function(e){return a("attack",e.target.value)}}),Object(s.jsx)(d,{label:"attackCurve",name:"attackCurve",value:t("attackCurve"),onChange:function(e){return a("attackCurve",e.target.value)},children:["linear","exponential"]}),Object(s.jsx)(u,{label:"decay",id:"decay",min:"0",step:"0.001",value:t("decay"),onChange:function(e){return a("decay",e.target.value)}}),Object(s.jsx)(d,{label:"decayCurve",name:"decayCurve",value:t("decayCurve"),onChange:function(e){return a("decayCurve",e.target.value)},children:["linear","exponential"]}),Object(s.jsx)(u,{label:"release",id:"release",min:"0",step:"0.001",value:t("release"),onChange:function(e){return a("release",e.target.value)}}),Object(s.jsx)(d,{label:"releaseCurve",name:"releaseCurve",value:t("releaseCurve"),onChange:function(e){return a("releaseCurve",e.target.value)},children:["linear","exponential"]}),Object(s.jsx)(u,{label:"sustain",id:"sustain",min:"0.1",max:"1",step:"0.001",value:t("sustain"),onChange:function(e){return a("sustain",e.target.value)}})]})]})},F=a(4),L=a(25),R=(a(53),function(e){var t=Object(L.a)(e),a=t.slice(0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return a.reduce((function(e,t,r){return r%n?e:[].concat(Object(F.a)(e),[a.slice(r,r+n)])}),[])}),U=Object(P.c)(21,109),B=U.length/2,Y=function(e){return Object(y.a)(e,"midi").toNote()},H=function(e){switch((e-20)%12){case 0:case 2:case 5:case 7:case 10:return!0;default:return!1}};var q=function(e){var t=e.useSynth,a=(void 0===t?I:t)(),r=Object(n.useState)(!1),c=Object(l.a)(r,2),i=c[0],o=c[1],u=function(e){var t=e.target.dataset;t.keyNum&&(t.active=!0,null===a||void 0===a||a.triggerAttack(Y(t.keyNum),Object(y.e)()))},d=function(e){var t=e.target.dataset;t.keyNum&&(t.active=!1,null===a||void 0===a||a.triggerRelease(Y(t.keyNum)))};return Object(n.useEffect)((function(){var e=function(){return o(!0)},t=function(){return o(!1)};return document.addEventListener("pointerdown",e),document.addEventListener("pointerup",t),function(){document.removeEventListener("pointerdown",e),document.removeEventListener("pointerup",t)}}),[]),Object(s.jsx)("div",{className:"the-keyboard el-stack",style:{margin:"0 auto"},onPointerDown:u,onPointerOver:function(e){return i&&u(e)},onPointerUp:d,onPointerOut:function(e){return i&&d(e)},children:R(U,B).reverse().map((function(e,t){return Object(s.jsx)("div",{className:"the-keyboard__row",children:e.map((function(e){var t=Y(e);return Object(s.jsx)("div",{className:"the-keyboard__key-container",children:Object(s.jsx)("div",{className:"the-keyboard__key "+(H(e)?"--black":"--white"),"data-key-num":e,children:Object(s.jsx)("span",{className:"the-keyboard__label",children:/C[1-8]/.test(t)?t:""})})},e-21)}))},t)}))})};var J=function(e){return Object(s.jsx)("a",{className:"base-link",href:e.url,target:"_blank",rel:"noopener noreferrer",children:e.label})};var G=function(){return Object(s.jsx)("div",{className:"the-footer-child el-center",children:Object(s.jsxs)("small",{className:"the-footer-child__container",children:[Object(s.jsx)(J,{url:"https://github.com/l1ck0h/keyboard",label:"GitHub"})," / \xa9 2022 l1ck0h"]})})};a(54);var z=function(){var e=Object(n.useReducer)(N,k),t=Object(l.a)(e,2),a=t[0],r=t[1];return Object(s.jsx)("div",{className:"App",children:Object(s.jsx)(C.Provider,{value:{state:a,dispatch:r},children:Object(s.jsxs)("div",{className:"el-cover",children:[Object(s.jsx)(E,{}),Object(s.jsx)("div",{className:"el-reel",children:Object(s.jsx)(q,{})}),Object(s.jsx)(G,{})]})})})},K=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,60)).then((function(t){var a=t.getCLS,n=t.getFID,r=t.getFCP,c=t.getLCP,i=t.getTTFB;a(e),n(e),r(e),c(e),i(e)}))};a(55),a(56),a(57),a(58);i.a.render(Object(s.jsx)(r.a.StrictMode,{children:Object(s.jsx)(z,{})}),document.getElementById("root")),K()}},[[59,1,2]]]);
//# sourceMappingURL=main.9a6534da.chunk.js.map