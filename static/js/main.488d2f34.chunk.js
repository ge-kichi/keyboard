(this.webpackJsonpkeyboard=this.webpackJsonpkeyboard||[]).push([[0],{31:function(e,t,n){},50:function(e,t,n){},58:function(e,t,n){"use strict";n.r(t);var a=n(6),r=n.n(a),c=n(23),s=n.n(c),i=(n(31),n(3)),u=n(4),o=n(24),l=n(7),d=n(8),j=n(1),b=(new d.c).toDestination(),v=b.get(),h=Object(a.createContext)({}),m={synth:b,synthParams:v,toneState:"stopped"},f=function(e,t){switch(t.type){case"SET_SYNTH_PARAMS":return Object(j.a)(Object(j.a)({},e),{},{synthParams:t.payload.synthParams});case"PLAY_MIDI":return Object(j.a)(Object(j.a)({},e),{},{toneState:d.d.start().state});case"PAUSE_MIDI":return Object(j.a)(Object(j.a)({},e),{},{toneState:d.d.pause().state});case"STOP_MIDI":return Object(j.a)(Object(j.a)({},e),{},{toneState:d.d.stop().state})}},O=function(){return Object(a.useContext)(h)},p=function(){var e=O().state;return{synth:e.synth,toneState:e.toneState}},x=n(25),y=function(e){var t=Object(a.useRef)(e);Object(a.useEffect)((function(){t.current=e}),[e]),Object(a.useEffect)((function(){var e=setInterval((function(){return t.current()}),1e3);return function(){return clearInterval(e)}}),[])},g=function(){var e=Object(a.useState)(0),t=Object(i.a)(e,2),n=t[0],r=t[1],c=Object(a.useState)(0),s=Object(i.a)(c,2),u=s[0],o=s[1],l=Object(a.useState)(!0),j=Object(i.a)(l,2),b=j[0],v=j[1],h=Object(a.useState)(0),m=Object(i.a)(h,2),f=m[0],p=m[1],g=O(),C=g.state,k=g.dispatch,N=C.synth,S=C.toneState;return y((function(){switch(S){case"started":n>f?p(f+1):(clearInterval(u),p(0),o(0),k({type:"STOP_MIDI"}));break;case"stopped":case"paused":clearInterval(u)}})),{state:{duration:n,playerDisabled:b,time:f,toneState:S},handlers:{loadMidi:function(e){var t=new x.Midi(e);d.d.cancel(),t.tracks.forEach((function(e){new d.b((function(e,t){null===N||void 0===N||N.triggerAttackRelease(t.name,t.duration,e,t.velocity);var n=document.querySelector('[data-key-num="'.concat(function(e){return Object(d.a)(e).toMidi()}(t.name),'"]'));if(n){var a=n.dataset;a.active="true",setTimeout((function(){return a.active="false"}),1e3*t.duration)}}),e.notes).start()})),r(Math.ceil(t.duration)),v(!1),p(0),k({type:"PLAY_MIDI"})},playPause:function(){"started"!==S?k({type:"PLAY_MIDI"}):(o(0),k({type:"PAUSE_MIDI"}))},stop:function(){o(0),p(0),k({type:"STOP_MIDI"})}}}},C=function(e,t){switch(e){case"detune":case"portamento":case"volume":return t(Object(l.b)([e]));case"type":case"partialCount":case"phase":return t(Object(l.b)(["oscillator",e]));case"attack":case"attackCurve":case"decay":case"decayCurve":case"release":case"releaseCurve":case"sustain":return t(Object(l.b)(["envelope",e]))}},k=Object(l.a)((function(e,t){return Object(l.e)(t,e)})),N=Object(l.a)((function(e,t,n){return Object(l.d)(t,n,e)})),S=function(){var e=O(),t=e.state,n=e.dispatch,a=k(t.synthParams),r=N(t.synthParams);return{getParams:function(e){return C(e,(function(e){return a(e)}))},setParams:function(e,a){var c=C(e,(function(e){var n=r(e);return t.synth.set(n(a||"0")),n(a)}));n({type:"SET_SYNTH_PARAMS",payload:{synthParams:c}})}}},P=(n(50),n(2)),w=[],M=function(e){for(var t=0;t<w.length;t++)e(w[t])},_=function(e){var t=e.mqComponents,n=Object(a.useState)(null),r=Object(i.a)(n,2),c=r[0],s=r[1];return Object(a.useEffect)((function(){var e=function(e){return M((function(e){return e.matches&&s(t[e.media])}))};for(var n in t){var a=window.matchMedia(n);w.push(a)}return e(),M((function(t){return t.addEventListener("change",e)})),function(){return M((function(t){return t.removeEventListener("change",e)}))}}),[t]),Object(P.jsx)(P.Fragment,{children:c})},I=function(e){var t=Object(o.a)(e),n=t.slice(0),a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return n.reduce((function(e,t,r){return r%a?e:[].concat(Object(u.a)(e),[n.slice(r,r+a)])}),[])},E=!1,A=function(){return E=!0},D=function(){return E=!1},L=function(e){return E&&e.preventDefault()},T=function(e){return Object(d.a)(e,"midi").toNote()},F=function(e){switch((e-20)%12){case 0:case 2:case 5:case 7:case 10:return!0;default:return!1}};var R=function(e){var t=e.useKeyboard,n=(void 0===t?p:t)(),r=n.synth,c=n.toneState,s=function(e){var t=T(e);return Object(P.jsx)("div",{className:"the-keyboard__key-container",children:Object(P.jsx)("div",{className:"the-keyboard__key "+(F(e)?"--black":"--white"),"data-key-num":e,children:Object(P.jsx)("span",{className:"the-keyboard__label",children:/C[1-8]/.test(t)?t:""})})},e-21)},i=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function(n){if(t){var a=e.length/2;return I(e,a).reverse().map((function(e,t){return Object(P.jsx)("div",{className:"the-keyboard__row "+("started"===n?"--notAllowed":""),children:e.map((function(e){return s(e)}))},t)}))}return Object(P.jsx)("div",{className:"the-keyboard__row "+("started"===n?"--notAllowed":""),children:e.map((function(e){return s(e)}))})}},u=function(e){e.preventDefault();var t=e.target.dataset;t.keyNum&&(t.active=!0,null===r||void 0===r||r.triggerAttack(T(t.keyNum),Object(d.e)()))},o=function(e){e.preventDefault();var t=e.target.dataset;t.keyNum&&(t.active=!1,null===r||void 0===r||r.triggerRelease(T(t.keyNum)))};return Object(a.useEffect)((function(){return document.addEventListener("mousedown",A),document.addEventListener("mouseup",D),document.addEventListener("mousemove",L,{passive:!1}),function(){document.removeEventListener("mousedown",A),document.removeEventListener("mouseup",D),document.removeEventListener("mousemove",L)}}),[]),Object(P.jsx)("div",{className:"the-keyboard el-stack",onMouseDown:u,onMouseOver:function(e){return E&&u(e)},onMouseUp:o,onMouseOut:function(e){return E&&o(e)},onTouchStart:u,onTouchEnd:o,children:Object(P.jsx)(_,{mqComponents:{"not all and (min-width: 640px)":function(e){return i(Object(l.c)(60,72),!1)(e)}(c),"(min-width: 640px)":function(e){return i(Object(l.c)(53,78),!1)(e)}(c),"(min-width: 768px)":function(e){return i(Object(l.c)(48,80),!1)(e)}(c),"(min-width: 1024px)":function(e){return i(Object(l.c)(43,85),!1)(e)}(c),"(min-width: 1280px)":function(e){return i(Object(l.c)(21,109))(e)}(c)}})})},Y=function(e){var t=e.id,n=e.name,a=e.title,r=e.children;return Object(P.jsxs)("div",{className:"accordion",children:[Object(P.jsx)("input",{type:"checkbox",id:t,name:n,hidden:!0}),Object(P.jsxs)("label",{className:"accordion-header",htmlFor:t,children:[Object(P.jsx)("i",{className:"icon icon-arrow-right mr-1"}),a]}),Object(P.jsx)("div",{className:"accordion-body",children:r})]})},q=function(e){var t=e.children,n=a.Children.toArray(t),r=Object(i.a)(n,2),c=r[0],s=r[1];return Object(P.jsxs)("div",{className:"el-cluster el-cluster--justify:flex-start el-cluster--space:0",children:[Object(P.jsx)("div",{style:{width:"95px"},children:c}),Object(P.jsx)("div",{children:s})]})},B=function(e){var t=e.id,n=e.label,a=e.min,r=e.max,c=e.step,s=e.value,i=e.onChange;return Object(P.jsxs)(q,{children:[Object(P.jsx)("label",{className:"form-label",htmlFor:t,children:n}),Object(P.jsx)("input",{type:"number",id:t,className:"form-input",min:a,max:r,step:c,value:s,onChange:i})]})};var H=function(){var e=S(),t=e.getParams,n=e.setParams;return Object(P.jsxs)(Y,{id:"options",title:"options",name:"options",children:[Object(P.jsx)(B,{id:"detune",label:"detune",value:t("detune"),onChange:function(e){return n("detune",e.target.value)}}),Object(P.jsx)(B,{id:"portamento",label:"portamento",min:"0",value:t("portamento"),onChange:function(e){return n("portamento",e.target.value)}}),Object(P.jsx)(B,{id:"volume",label:"volume",value:t("volume"),onChange:function(e){return n("volume",e.target.value)}})]})},U=function(e){var t=e.id,n=e.label,r=e.onChange,c=e.children,s=e.value;return Object(P.jsxs)(q,{children:[Object(P.jsx)("label",{className:"form-label",htmlFor:t,children:n}),Object(P.jsx)("select",{id:t,className:"form-select",value:s,onChange:r,children:a.Children.map(c,(function(e,t){return Object(P.jsx)("option",{value:e,children:e},t)}))})]})};var J=function(){var e=S(),t=e.getParams,n=e.setParams;return Object(P.jsxs)(Y,{id:"oscillator",title:"oscillator",name:"oscillator",children:[Object(P.jsx)(U,{id:"type",label:"type",value:t("type"),onChange:function(e){return n("type",e.target.value)},children:["sine","square","sawtooth","triangle"]}),Object(P.jsx)(B,{id:"partialCount",label:"partialCount",min:"0",step:"1",value:t("partialCount"),onChange:function(e){return n("partialCount",e.target.value)}}),Object(P.jsx)(B,{id:"phase",label:"phase",min:"0",step:"0.1",value:t("phase"),onChange:function(e){return n("phase",e.target.value)}})]})},G=function(e){var t=e.label,n=e.name,r=e.value,c=e.children,s=e.onChange;return Object(P.jsxs)(q,{children:[Object(P.jsx)("label",{className:"form-label",children:t}),Object(P.jsx)(P.Fragment,{children:a.Children.map(c,(function(e,t){return Object(P.jsxs)("label",{className:"form-radio form-inline",children:[Object(P.jsx)("input",{type:"radio",name:n,value:e,checked:e===r,onChange:s}),Object(P.jsx)("i",{className:"form-icon"}),e]},t)}))})]})},K=["linear","exponential"];var W=function(){var e=S(),t=e.getParams,n=e.setParams;return Object(P.jsxs)(Y,{id:"envelope",title:"envelope",name:"envelope",children:[Object(P.jsx)(B,{id:"attack",label:"attack",min:"0",step:"0.001",value:t("attack"),onChange:function(e){return n("attack",e.target.value)}}),Object(P.jsx)(G,{label:"attackCurve",name:"attackCurve",value:t("attackCurve"),onChange:function(e){return n("attackCurve",e.target.value)},children:K}),Object(P.jsx)(B,{id:"decay",label:"decay",min:"0",step:"0.001",value:t("decay"),onChange:function(e){return n("decay",e.target.value)}}),Object(P.jsx)(G,{label:"decayCurve",name:"decayCurve",value:t("decayCurve"),onChange:function(e){return n("decayCurve",e.target.value)},children:K}),Object(P.jsx)(B,{id:"release",label:"release",min:"0",step:"0.001",value:t("release"),onChange:function(e){return n("release",e.target.value)}}),Object(P.jsx)(G,{label:"releaseCurve",name:"releaseCurve",value:t("releaseCurve"),onChange:function(e){return n("releaseCurve",e.target.value)},children:K}),Object(P.jsx)(B,{id:"sustain",label:"sustain",min:"0.1",max:"1",step:"0.001",value:t("sustain"),onChange:function(e){return n("sustain",e.target.value)}})]})};var z=function(){return Object(P.jsxs)("div",{children:[Object(P.jsx)(H,{}),Object(P.jsx)(J,{}),Object(P.jsx)(W,{})]})},Q=function(e){var t=e.url,n=e.label;return Object(P.jsx)("a",{className:"base-link",href:t,target:"_blank",rel:"noopener noreferrer",children:n})};var V=function(){return Object(P.jsx)("footer",{className:"el-center",style:{position:"sticky",top:"100vh",marginTop:0},children:Object(P.jsxs)("small",{children:[Object(P.jsx)(Q,{url:"https://github.com/l1ck0h/keyboard",label:"GitHub"})," / \xa9 2022 l1ck0h"]})})},X=n(16),Z=n(26),$=function(e){var t=e.onClick,n=e.disabled,a=e.iconProp;return Object(P.jsx)("button",{className:"btn btn-action s-circle",onClick:t,disabled:n,children:Object(P.jsx)(Z.a,{icon:a})})},ee=function(e){var t=function(e){return e.toString().padStart(2,"0")},n=Math.floor(e%86400/3600),a=Math.floor(e%86400%3600/60),r=Math.floor(e%86400%3600%60);return n?n+":"+a+":"+t(r):a+":"+t(r)},te=function(e){var t=e.time,n=e.duration;return Object(P.jsxs)("span",{className:"base-time",children:[ee(t)," / ",ee(n)]})};var ne=function(){var e=g(),t=e.state,n=e.handlers;return Object(P.jsxs)("div",{children:[Object(P.jsx)("div",{className:"form-group",children:Object(P.jsx)("input",{type:"file",id:"dropFile",className:"form-input",accept:"audio/midi",onChange:function(e){var t=Object(i.a)(e.target.files,1)[0],a=new FileReader;a.onload=function(e){return n.loadMidi(e.target.result)},a.readAsArrayBuffer(t)}})}),Object(P.jsxs)("div",{className:"el-cluster el-cluster--justify:flex-start",children:[Object(P.jsx)($,{onClick:n.playPause,iconProp:"started"!==t.toneState?X.b:X.a,disabled:t.playerDisabled}),Object(P.jsx)($,{onClick:n.stop,iconProp:X.c,disabled:t.playerDisabled}),Object(P.jsx)(te,{time:t.time,duration:t.duration})]})]})};var ae=function(){var e=Object(a.useReducer)(f,m),t=Object(i.a)(e,2),n=t[0],r=t[1];return Object(P.jsx)("div",{className:"App",children:Object(P.jsx)(h.Provider,{value:{state:n,dispatch:r},children:Object(P.jsxs)("div",{className:"el-cover",children:[Object(P.jsx)("div",{children:Object(P.jsxs)("div",{className:"el-with-sidebar el-with-sidebar--right el-with-sidebar--noStretch",style:{"--sideWidth":"15rem","--contentMin":"75%"},children:[Object(P.jsxs)("div",{className:"el-stack",children:[Object(P.jsx)(R,{}),Object(P.jsx)(ne,{})]}),Object(P.jsx)(z,{})]})}),Object(P.jsx)(V,{})]})})})},re=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,59)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,s=t.getTTFB;n(e),a(e),r(e),c(e),s(e)}))};n(54),n(55),n(56),n(57);s.a.render(Object(P.jsx)(r.a.StrictMode,{children:Object(P.jsx)(ae,{})}),document.getElementById("root")),re()}},[[58,1,2]]]);
//# sourceMappingURL=main.488d2f34.chunk.js.map